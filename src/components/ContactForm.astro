---
import settings from "../settings.js";
---
<section id="contact" class="py-16 md:py-24 bg-primary text-white">
	<div class="container mx-auto px-4">
		<div class="text-center mb-12">
			<h2 class="text-3xl font-bold mb-4 font-heading">WHY WAIT? CONTACT US TODAY FOR A FREE ESTIMATE!</h2>
			<p class="text-lg max-w-3xl mx-auto">
				Fill out the form below and one of our HVAC specialists will get back to you as soon as possible to discuss your
				needs and provide a free, no-obligation estimate.
			</p>
		</div>

		<div class="max-w-3xl mx-auto">
			<!-- Zapier direct Edit link: https://zapier.com/editor/297962170/draft/297962171/fields -->
			<!-- Zapier Hook: https://hooks.zapier.com/hooks/catch/675466/27r9bjl/ -->
			<div id="formResponse"></div>
			<form class="grid grid-cols-1 md:grid-cols-2 gap-6" id="contactForm">
				<div class="md:col-span-1">
					<label for="name" class="block mb-2 font-medium">Full Name</label>
					<input
						type="text"
						id="name"
						name="name"
						class="w-full px-4 py-3 rounded-md bg-white/10 border border-white/20 focus:border-secondary focus:outline-none focus:ring-2 focus:ring-secondary/50 text-white"
						placeholder="Your Name"
						required
					/>
				</div>

				<div class="md:col-span-1">
					<label for="email" class="block mb-2 font-medium">Email Address</label>
					<input
						type="email"
						id="email"
						name="email"
						class="w-full px-4 py-3 rounded-md bg-white/10 border border-white/20 focus:border-secondary focus:outline-none focus:ring-2 focus:ring-secondary/50 text-white"
						placeholder="your.email@example.com"
						required
					/>
				</div>

				<div class="md:col-span-1">
					<label for="phone" class="block mb-2 font-medium">Phone Number</label>
					<input
						type="tel"
						id="phone"
						name="phone"
						class="w-full px-4 py-3 rounded-md bg-white/10 border border-white/20 focus:border-secondary focus:outline-none focus:ring-2 focus:ring-secondary/50 text-white"
						placeholder={settings.phonePlaceholder}
						required
					/>
				</div>

				<div class="md:col-span-1">
					<label for="service" class="block mb-2 font-medium">Service Needed</label>
					<select
						id="service"
						name="service"
						class="w-full px-4 py-3 rounded-md bg-white/10 border border-white/20 focus:border-secondary focus:outline-none focus:ring-2 focus:ring-secondary/50 text-white"
						required
					>
						<option value="" disabled selected>Select a Service</option>
						<option value="ac-repair" class="text-black">AC Repair</option>
						<option value="ac-installation" class="text-black">AC Installation</option>
						<option value="heating-repair" class="text-black">Heating Repair</option>
						<option value="heating-installation" class="text-black">Heating Installation</option>
						<option value="maintenance" class="text-black">Maintenance</option>
						<option value="air-quality" class="text-black">Indoor Air Quality</option>
						<option value="other" class="text-black">Other</option>
					</select>
				</div>

				<div class="md:col-span-2">
					<label for="address" class="block mb-2 font-medium">Address</label>
					<input
						type="text"
						id="address"
						name="address"
						class="w-full px-4 py-3 rounded-md bg-white/10 border border-white/20 focus:border-secondary focus:outline-none focus:ring-2 focus:ring-secondary/50 text-white"
						placeholder="Your Address"
					/>
				</div>

				<div class="md:col-span-2">
					<label for="message" class="block mb-2 font-medium">Message</label>
					<textarea
						id="message"
						name="message"
						rows="5"
						class="w-full px-4 py-3 rounded-md bg-white/10 border border-white/20 focus:border-secondary focus:outline-none focus:ring-2 focus:ring-secondary/50 text-white"
						placeholder="Please describe your HVAC needs or issues..."
						required
					></textarea>
				</div>

				<div class="md:col-span-2 text-center">
					<input type="hidden" name="af-form" value="comp-contact-form"/>
					<input type="hidden" id="comp-contact-form-hash" name="af-hash" value="failed"/>
					<input type="hidden" id="comp-contact-form-url" name="af-url" value=""/>
					<button
						type="submit"
						class="bg-secondary hover:bg-secondary/90 text-white font-bold py-3 px-8 rounded-md transition-colors"
					>
						SUBMIT
					</button>
				</div>
			</form>

			<div class="mt-12 text-center">
				<p class="mb-4">Prefer to call us directly?</p>
				<a href={`tel:${settings.phoneRaw}`} class="text-2xl font-bold hover:text-secondary transition-colors">
					{settings.phone}
				</a>
			</div>
		</div>
	</div>
</section>

<script>
	// Function to fetch refresh hash when the page loads
	async function fetchRefreshHash() {
		try {
			const response = await fetch('https://api.astraforms.site/', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
				},
				body: JSON.stringify({action: "forminit"}),
			});

			if (response.ok) {
				const data = await response.json();
				// Populate the hidden input field with the refresh hash
				const refreshHashInput = document.getElementById('comp-contact-form-hash') as HTMLInputElement;
				if (refreshHashInput) {
					refreshHashInput.value = data.hash || '';
				}
				const urlInput = document.getElementById('comp-contact-form-url') as HTMLInputElement;
				if (urlInput) {
					urlInput.value = window.location.href;
				}
			} else {
				console.error('Failed to fetch refresh hash');
			}
		} catch (error) {
			console.error('Error fetching refresh hash:', error);
		}
	}

	// Fetch refresh hash when the page loads
	document.addEventListener('DOMContentLoaded', fetchRefreshHash);

	// Handle form submission
	document.addEventListener('DOMContentLoaded', () => {
		const form = document.getElementById('contactForm');
		const formResponseDiv = document.getElementById('formResponse');

		if (!form || !formResponseDiv) return;

		form.addEventListener('submit', async function (event) {
			event.preventDefault();

			// Create FormData object
			const formData = new FormData(this as HTMLFormElement);
			// Convert FormData to JSON object
			let formDataObj = Object.fromEntries(formData.entries());
			formDataObj.action = "submit";
			try {
				const response = await fetch('https://api.astraforms.site/', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
					},
					body: JSON.stringify(formDataObj),
				});

				if (response.ok) {
					const result = await response.json();

					if (result.status === 'success') {
						// Clear the form
						(this as HTMLFormElement).reset();
						// Fetch a new refresh hash
						await fetchRefreshHash();
						// Show a success message
						formResponseDiv.innerHTML = `
              <div class="p-4 bg-green-500 text-white rounded-md mb-6">
                Your message has been sent successfully! We'll get back to you as soon as possible.
              </div>
            `;

						// Remove success message after 5 seconds
						setTimeout(() => {
							formResponseDiv.innerHTML = '';
						}, 5000);
					} else if (result.status === 'expired') {
						// Show expired message
						formResponseDiv.innerHTML = `
              <div class="p-4 bg-red-500 text-white rounded-md mb-6">
                The form has expired. Please refresh the page and try again.
              </div>
            `;
					} else {
						// Show generic error message
						formResponseDiv.innerHTML = `
              <div class="p-4 bg-red-500 text-white rounded-md mb-6">
                There was an error submitting the form. Please try again.
              </div>
            `;
					}
				} else {
					throw new Error('Network response was not ok');
				}
			} catch (error) {
				console.error('Error submitting form:', error);
				// Show error message
				formResponseDiv.innerHTML = `
          <div class="p-4 bg-red-500 text-white rounded-md mb-6">
            There was an error submitting the form. Please try again.
          </div>
        `;
			}
		});
	});
</script>
